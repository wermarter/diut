<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      * {
        font-family: 'Times New Roman', monospace;
      }
      html {
        font-size: 15px;
      }
      @page {
        margin-top: 5mm;
        margin-bottom: 7mm;
        margin-left: 20mm;
        margin-right: 10mm;
      }
      p {
        page-break-inside: avoid;
      }
      .print-footer {
        position: fixed;
        bottom: 0;
        font-size: 10px;
        width: 100%;
      }
    </style>
  </head>
  <% 
    const isPositive = data.categories[0]?.tests[0]?.elements[0]?.isAbnormal;
    const resultValue = data.categories[0]?.tests[0]?.elements[0]?.value;
  %>
  <body>
    <div class="print-footer">
      <%= isPositive ? 'BM4.MD1.MD1' : 'BM5.MD1.MD1' %>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      Phiên bản: 2.0
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      Ngày hiệu lực: 01/01/2026
    </div>

    <div class="flex flex-row justify-between items-start">
      <div class="text-center">
        <p>TRUNG TÂM KIỂM SOÁT BỆNH TẬT</p>
        <p>THÀNH PHỐ HỒ CHÍ MINH</p>
        <p class="font-bold"><%= meta.branch.name %></p>
        <p class="italic">Địa chỉ: <%= meta.branch.address %></p>
        <p class="italic">Điện thoại: <%= meta.branch.phoneNumber %></p>
      </div>
      <div class="text-center">
        <p class="font-bold">CỘNG HÒA XÃ HỘI CHỦ NGHĨA VIỆT NAM</p>
        <p class="font-bold">Độc lập – Tự do – Hạnh phúc</p>
        <div class="border-b border-black w-32 mx-auto mt-1"></div>
      </div>
    </div>

    <div class="text-center mt-8">
      <p class="text-2xl font-bold">KẾT QUẢ XÉT NGHIỆM HIV <%= isPositive ? 'DƯƠNG TÍNH' : '' %></p>
    </div>

    <div class="flex flex-row justify-center mt-4 space-x-20">
      <div class="space-y-1">
        <p>Ngày gửi mẫu: <span class="font-bold"><%= data.sample.sampledAt.toLocaleDateString('vi') %></span></p>
        <p>Nơi gửi mẫu: <span class="font-bold"><%= meta.branch.name %></span></p>
      </div>
      <div class="space-y-1">
        <p>Bản:</p>
        <p>Mã số: <span class="font-bold"><%= data.sample.sampleId %></span></p>
      </div>
    </div>

    <div class="mt-6 space-y-1">
      <p>Họ và tên bệnh nhân: <span class="font-bold"><%= data.sample.patient.name.toLocaleUpperCase() %></span></p>
      <p>Năm sinh/Tuổi: <span class="font-bold"><%= data.sample.patient.birthYear %></span></p>
      <p>Giới tính: <span class="font-bold"><%= data.sample.patient.gender === "Male" ? "Nam" : "Nữ" %></span></p>
      <p>Loại bệnh phẩm: <span class="font-bold"><%= meta.sampleTypeNames.join(', ') %></span></p>
      <p>Mã số nơi gửi:</p>
      <p>Mã BN(PID): <span class="font-bold"><%= data.sample.patient.externalId || '' %></span></p>
      <p>Số BHYT: <span class="font-bold"><%= data.sample.patient.healthId || '' %></span></p>
      <p>CMND/CCCD/Hộ chiếu: <span class="font-bold"><%= data.sample.patient.SSN %></span></p>
      <p>Địa chỉ thường trú: <span class="font-bold"><%= data.sample.patient.address %></span></p>
      <p>Địa chỉ tạm trú: <span class="font-bold"><%= data.sample.patient.address %></span></p>
      <p>Yêu cầu xét nghiệm: <span class="font-bold"><%= data.categories[0].tests[0].name %></span></p>
      <p>Kỹ thuật xét nghiệm:</p>
      <ul class="list-disc ml-12 font-bold">
        <% data.categories[0].tests[0].elements.slice(1).forEach(element => { %>
          <li><%= element.testElement.name %></li>
        <% }) %>
      </ul>
    </div>

    <div class="mt-10 space-y-1">
      <p class="font-bold">Kết luận: <%= isPositive ? 'Kháng thể kháng HIV Dương tính' : 'Kháng thể kháng HIV Âm tính/Không xác định' %></p>
      <p>Ngày xét nghiệm khẳng định: <span class="font-bold"><%= data.sample.sampledAt.toLocaleDateString('vi') %></span></p>
      <p>Đề nghị: Tham vấn</p>
    </div>

    <div class="flex flex-row justify-between mt-10">
      <div class="text-center w-1/2">
        <% if (isPositive) { %>
          <p class="font-bold">GIÁM ĐỐC</p>
        <% } %>
      </div>
      <div class="text-center w-1/2">
        <% if (!isPositive) { %>
          <p class="italic mb-2">TP. HCM, ngày <%= data.sample.infoAt.getDate() %> tháng <%= data.sample.infoAt.getMonth() + 1 %> năm <%= data.sample.infoAt.getFullYear() %></p>
        <% } %>
        <p class="font-bold"><%= meta.authorTitle %></p>
        <div style="margin-top: 30mm">
          <p class="font-bold"><%= meta.authorName %></p>
        </div>
      </div>
    </div>

    <div class="mt-20">
      <p class="font-bold"><%= meta.authorName %></p>
    </div>
  </body>
</html>
