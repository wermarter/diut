name: hcdc-access-service

on:
  workflow_dispatch:
  push:
    branches:
      - main
      - develop
    paths:
      - 'libs/common/**'
      - 'libs/nestjs-infra/**'
      - 'libs/hcdc/**'
      - 'libs/services/**'
      - 'apps/hcdc-access-service/**'

jobs:
  j1:
    uses: ./.github/workflows/docker-publish.yaml
    with:
      dockerfile-path: ./k8s/apps/hcdc-access-service/Dockerfile
      docker-image-name: diut-hcdc-access-service
    secrets: inherit

  j2:
    needs: j1
    uses: ./.github/workflows/helm-update.yaml
    with:
      values-path: ${{ github.ref_name == 'main' && './k8s/apps/hcdc-access-service/helm-chart/values.yaml' || './k8s/apps/hcdc-access-service/helm-chart/values-dev.yaml' }}
      identity: hcdc-access-service
    secrets: inherit
